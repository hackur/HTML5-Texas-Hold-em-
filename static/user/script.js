(function(a){window.awardDialog={show:function(){a(".awardDialog").show();a("#screen-overlay").addClass("screen-cover")}}})($);(function(a){window.settingNickDialog={show:function(){a(".settingNickDialog").show()}}})($);$(function(){$(".awardDialog").click(function(){$(".awardDialog").hide();$("#screen-overlay").removeClass("screen-cover")})});
$(function(){$(".femaleCheck").click(function(){a=0;$(".femaleCheck").css("background","url(./image/check.png)");$(".maleCheck").css("background","url(./image/nocheck.png)")});$(".maleCheck").click(function(){a=1;$(".maleCheck").css("background","url(./image/check.png)");$(".femaleCheck").css("background","url(./image/nocheck.png)")});var a=1;$("#confirmBtn").click(function(){b()});$("#cancelBtn").click(function(){$(".settingNickDialog").hide();history.go(-1)});$("#closeButton").click(function(){$(".settingNickDialog").hide();
history.go(-1)});var b=function(){var b=-1,c="-1",b=0==a?"F":"M",c=$("#nickname-input").val();""!=c&&($(".settingNickDialog").hide(),$.ajax({type:"post",url:"/userinfo",data:{nickname:c,gender:b},success:function(a){console.log(a);"success"==a.status?(console.log("success"),info_init()):console.log("failed")},dataType:"json"}))}});function Email(a){var b={},d=null;init=function(a){b.id=a.id;b.sendDate=a.date;b.message=a.message;b.senderId=a.sender_id;b.senderName=a.sender_name};b.toHTML=function(){d=$('<div class="mail-item"><div class="content">'+b.sendDate+": "+b.senderName+'</div><div class="mail-border"></div></div>');d.bind("vclick",c);return d};var c=function(){$("#sender").text("\u53d1\u4ef6\u4eba\uff1a"+b.senderName);$("#time").text("\u65f6\u95f4\uff1a"+b.sendDate);$("#content").text("\u5185\u5bb9\uff1a"+b.message);
$("#bigFrame2").css("display","block");$("#mail_list_frame").css("display","none");window.SelectedEmail=b};init(a);return b}window.EmailList=[];window.SelectedEmail=null;window.get_event_position=function(a){window.touch_enable&&a.touches&&(a.touches[0]?(a.clientX=a.touches[0].pageX,a.clientY=a.touches[0].pageY):(a.clientX=a.changedTouches[0].pageX,a.clientY=a.changedTouches[0].pageY));return[a.clientX,a.clientY]};
var info_init=function(){var a=poptip();a.init($("#quick_accTip"),"quick_accTip","Quick Start Game","right",5);localStorage.quickStart||(a.Msg(),localStorage.quickStart=1);$.reject();dailyBonus();getUserImage();listEmail(1);buddyInfo();initCommodity();bindSendFriendEmail();window.bigframe=[{header:"#info",content:"#info_frame",background:"url(/static/user/image/left.png)"},{header:"#email",content:"#mail_list_frame",background:"url(/static/user/image/middle.png)"},{header:"#market",content:"#market_frame",
background:"url(/static/user/image/middle.png)"},{header:"#recharge",content:"#recharge_frame",background:"url(/static/user/image/middle.png)"},{header:"#friend",content:"#friend_frame",background:"url(/static/user/image/right.png)"}];$(bigframe[0].content).css("display","block");$(bigframe[0].header).css("background-image","url(/static/user/image/left.png)");$("#reply").bind("vclick",function(){$("#receiver").text("\u6536\u4ef6\u4ebaID\uff1a"+window.SelectedEmail.senderName);$("#replyFrame textarea").unbind("keyup");
$("#replyFrame").css("display","block");sendEmail()});$("#replay-cancel-btn").bind("vclick",function(){$("#replyFrame").css("display","none")});$("#delete").bind("vclick",function(){$.ajax({type:"post",url:"/delete-email",data:{email_id:window.SelectedEmail.id},success:function(){listEmail();$("#email").click()},dataType:"json"})});$("#mail_page_last").bind("vclick",function(){listEmail(window.EmailCurrentPage-1)});$("#mail_page_next").bind("vclick",function(){listEmail(window.EmailCurrentPage+1)});
$("#mail_page_btn").bind("vclick",function(){listEmail($("#mail_page_input").val())});for(a=0;a<bigframe.length;a++)frameControl(bigframe[a],a);$("#lobby").bind("vclick",function(){window.location="/static/room/room.html"});$("#quick_acc").bind("vclick",function(){$.ajax({type:"get",url:"/fast_enter",success:function(a){localStorage.current_room_id=a;window.location="/static/game/game.html"}})});$("#logout").bind("vclick",function(){window.location="/static/facebook.html"})},frameControl=function(a){$(a.header).bind("vclick",
function(){$(".bigFrame").css("display","none");$(".frame-header").css("background-image","none");$(a.content).css("display","block");$(a.header).css("background-image",a.background)})},uploadImage=function(){var a=$("#status");$("form").ajaxForm({complete:function(b){b=JSON.parse(b.responseText);console.log(b);if("success"==b.status){var d=b.url;console.log(b.url);console.log(d);a.html("upload success");$("#image1").attr("src",d)}}})},getUserImage=function(){$.ajax({type:"post",url:"/personal-archive",
data:{},success:function(a){console.log(a);var b=a.head_portrait;$("#image1").attr("src",b);$("#ID").html(textDict.id+" : "+a.name);$("#rank").html(textDict.rank+" : "+a.level);$("#property").html(textDict.property+" : "+a.asset);$("#winRate").html(textDict.winRate+" : "+a.percentage);$("#winBiggestStake").html(textDict.winBiggestStake+" : "+a.max_reward);$("#idiograph").html(textDict.idiograph+" : "+a.signature);$("#totalInnings").html(textDict.totalInnings+" : "+a.total_games);$("#victoryInnings").html(textDict.victoryInnings+
" : "+a.won_games);$("#latestOnline").html(textDict.latestOnline+" : "+a.last_login)},dataType:"json"})},listEmail=function(a){$.ajax({type:"post",url:"/list-email",data:{page:a},success:function(a){$("#mail_list").html("");for(var d=0;d<a.emails.length;d++){var c=Email(a.emails[d]);$("#mail_list").append(c.toHTML());window.EmailList.push(c)}window.EmailCurrentPage=a.current;window.EmailTotal=a.total;window.EmailTotalPages=a.pages;console.log(a)},dataType:"json"})},sendEmail=function(){$("#sureButton").unbind("vclick");
$("#sureButton").bind("vclick",function(){var a=window.SelectedEmail.id,b=$("#text1").val();$.ajax({type:"post",url:"/send-email",data:{content:b,destination:window.SelectedEmail.senderId,reply_to:a},success:function(a){console.log(a);$("#replyFrame").css("display","none");window.SelectedEmail=null},dataType:"json"})})},viewEmail=function(){$.ajax({type:"post",url:"/view-email",data:{email:1},success:function(a){console.log(a)},dataType:"json"})},buddyInfo=function(){$.ajax({type:"post",url:"/buddy-info/",
data:{},success:function(a){console.log(a);for(var b=0;b<a.friends.length;b++)$("#name"+b).html(a.friends[b].name),view_friend(a.friends[b],b)},dataType:"json"})},dailyBonus=function(){$.ajax({type:"get",url:"/dailybonus",data:{},success:function(a){"success"==a.status?window.awardDialog.show():console.log("failed")},dataType:"json"})},view_friend=function(a,b){$("#name"+b).click(function(){$("#fID").html("\u6635\u79f0\uff1a");$("#ffamily").html("\u5bb6\u65cf\uff1a");$("#fpos").html("\u804c\u4f4d\uff1a");
$("#frank").html("\u7b49\u7ea7\uff1a");$("#fpro").html("\u8d44\u4ea7\uff1a");$("#fID").html($("#fID").html()+a.name);$("#ffamily").html($("#ffamily").html()+a.family);$("#fpos").html($("#fpos").html()+a.position);$("#frank").html($("#frank").html()+a.level);$("#fpro").html($("#fpro").html()+a.asset);var b=a.head_portrait;$("#image3")[0].src=b;$("#image3").css({width:102,height:126,top:6,left:8,position:"absolute"});window.SelectedFriend=a})},bindSendFriendEmail=function(){$("#fsend").bind("vclick",
function(){console.log("fsend start");$("#email").click();$("#receiver").text("\u6536\u4ef6\u4ebaID\uff1a"+window.SelectedFriend.name);$("#replyFrame textarea").unbind("keyup");$("#replyFrame").css("display","block");$("#replyFrame").css("display","block");$("#sureButton").unbind("vclick");$("#sureButton").bind("vclick",function(){var a=window.SelectedFriend.id,b=$("#text1").val();$.ajax({type:"post",url:"/send-email",data:{content:b,destination:a},success:function(){$("#replyFrame").css("display",
"none");window.SelectedFriend=null},dataType:"json"})});console.log("fsend end")})};window.reloadUserInfo=getUserImage;(function(a,b){function d(a){var e={};e.info=a;e.construct=function(){var a=b("<div></div>"),d=b('<strike class="oprice"></strike>'),c=b('<div class="rpurchase"></div>');a.attr("id","convert"+e.info.index);a.html(e.info.description);d.html(e.info.orginal_price);c.attr("id","rpurchase"+e.info.index);c.html(e.info.price);c.bind("vclick",e.invokeOrder);a.appendTo(b("#recharge_frame"));c.appendTo(b("#recharge_frame"));d.appendTo(a)};e.invokeOrder=function(){var a={method:"pay",order_info:e.info.order_info,
action:"buy_item",dev_purchase_params:{oscif:!0}};console.log(a);FB.ui(a,e.orderCallback)};e.orderCallback=function(a){console.log("order callback [start]");console.log(e.info);a.order_id?(window.reloadUserInfo(),console.log("order done.")):console.log("order cancel.");console.log("order callback [end]")};e.construct();return e}var c=[{index:1,description:"1000 chips",order_info:201201,orginal_price:"10 Credits",price:"10 Credits"},{index:2,description:"2000 chips",order_info:201202,orginal_price:"20 Credits",
price:"19 Credits"},{index:3,description:"5000 chips",order_info:201203,orginal_price:"50 Credits",price:"46 Credits"},{index:4,description:"10000 chips",order_info:201204,orginal_price:"100 Credits",price:"90 Credits"},{index:5,description:"20000 chips",order_info:201205,orginal_price:"200 Credits",price:"175 Credits"},{index:6,description:"50000 chips",order_info:201206,orginal_price:"500 Credits",price:"440 Credits"}],f=[];console.log("==================commodities=======================");console.log(f);
window.initCommodity=function(){for(var a=0;a<c.length;a++)f.push(d(c[a]));window.commodities=f}})({},jQuery);
