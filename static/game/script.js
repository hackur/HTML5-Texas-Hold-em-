(function(c,a){function b(){console.log("disable_all");a.each(z,function(d,b){a(b).removeClass("buttonEnable");a(b).addClass("buttonDisable");a(b).addClass("buttonHide");a(b).unbind("click")});r()}function d(d,c){console.log("SEND ACTION!!");var f={action:d};c&&(f.amount=c);f=JSON.stringify(f);window.ws?window.ws.send(f):(console.log(f),a.ajax({type:"post",url:"/post-board-message",data:{message:f},success:function(a){console.log(a)},dataType:"json"}),b())}function e(){d(u)}function g(){d(y)}function f(){a("#btRaise").unbind("click");
j(0,100);a("#btRaiseText").html("OK");a("#raise_slider").show();window.addEventListener(event_down,o);window.addEventListener(event_up,m);var d=a("#raise_slider").offset().top+a("#raise_slider").height()-a("#raise_slider_button").height();a("#raise_slider_button").css("top",d-a("#raise_amount").offset().top+"px")}function h(){d(p)}function k(){window.user_info.userIsPlay=!1;d(E)}function j(d,b){var c=v[w][0],f=v[w][1],e;position=[];for(e=1;46>e;e++)if(G[e]>c){position[0]=e-1;break}for(;64>e;){if(G[e]>
f){position[1]=e;break}e++}e=position;e=G[e[0]+Math.floor(d/(b/(e[1]-e[0]+1)))];e<=c&&(e=c);e>=f&&(e=f);J=e;a("#raise_amount").html(e)}function l(d){var b=get_event_position(d)[1],c=a("#raise_amount").offset().top+a("#raise_amount").height(),f=a("#raise_slider").offset().top+a("#raise_slider").height()-a("#raise_slider_button").height(),b=H+(b-B);b>=c&&b<=f&&(a("#raise_slider_button").css("top",b-a("#raise_amount").offset().top+"px"),j(f-b,f-c),d.preventDefault())}function m(){window.removeEventListener(event_move,
l)}function r(d){a("#raise_slider").hide();a("#btRaiseText").html("Raise");d&&a("#btRaise").click(f);window.removeEventListener(event_down,o);window.removeEventListener(event_up,m)}function o(b){b.target==document.getElementById("raise_slider_button")?(window.addEventListener(event_move,l),B=get_event_position(b)[1],H=a("#raise_slider_button").offset().top):b.target==document.getElementById("raise_slider")?console.log("PASS!!!"):b.target==document.getElementById("btRaiseText")?(r(),d(w,J)):b.target!=
document.getElementById("raise_amount")&&r(!0);b.preventDefault()}function s(a){for(var d=0,b=0,c=0,f=0;f<a.length;)p==a[f]&&(d=1),u==a[f]&&(b=1),y==a[f]&&(c=1),f++;if(F){if(c)return g(),n(),!0;if(b)return e(),n(),!0}if(C){if(d)return h(),n(),!0;k();n();return!0}if(D&&d)return h(),n(),!0;n();return!1}function A(){console.log("disable autobuttons");a("#btAutoCheck").addClass("autoButtonHide");a("#btAutoCheck").unbind("vclick",q);a("#btAutoCheckOrFold").addClass("autoButtonHide");a("#btAutoCheckOrFold").unbind("vclick",
x);a("#btAutoCallAny").addClass("autoButtonHide");a("#btAutoCallAny").unbind("vclick",t)}function n(){D&&(a("#cbAutoCheck").removeClass("check"),a("#cbAutoCheck").addClass("noCheck"),D=0);C&&(a("#cbAutoCheckOrFold").removeClass("check"),a("#cbAutoCheckOrFold").addClass("noCheck"),C=0);F&&(a("#cbAutoCallAny").removeClass("check"),a("#cbAutoCallAny").addClass("noCheck"),F=0)}function q(){D?(a("#cbAutoCheck").removeClass("check"),a("#cbAutoCheck").addClass("noCheck"),D=0):(n(),a("#cbAutoCheck").removeClass("noCheck"),
a("#cbAutoCheck").addClass("check"),D=1)}function x(){C?(a("#cbAutoCheckOrFold").removeClass("check"),a("#cbAutoCheckOrFold").addClass("noCheck"),C=0):(n(),a("#cbAutoCheckOrFold").removeClass("noCheck"),a("#cbAutoCheckOrFold").addClass("check"),C=1)}function t(){F?(a("#cbAutoCallAny").removeClass("check"),a("#cbAutoCallAny").addClass("noCheck"),F=0):(n(),a("#cbAutoCallAny").removeClass("noCheck"),a("#cbAutoCallAny").addClass("check"),F=1)}var u=1,y=2,w=3,p=4,E=5,v,z={1:"#btAllin",4:"#btCheck",3:"#btRaise",
2:"#btCall",5:"#btFold"},I={1:e,2:g,3:f,4:h,5:k},D=0,C=!1,F=!1,B,H,J,G=[],K=[1,10,100,1E3,1E4,1E5,1E6,1E7],L=[9,1,2,3,4,5,6,7,8];(function(){for(var a=1;64>a;)G[a]=L[a%9]*K[Math.floor((a-1)/9)],a++})();c.enable_buttons=function(d,b){if(!s(d)){console.log(["enable_buttons",d,b]);var c=[u,p,w,y,E];v=b;a.each(d,function(d,f){if(void 0!=z[f]){console.log("index "+d+"value "+f);var e=z[f];a(e).addClass("buttonEnable");a(e).removeClass("buttonHide");a(e).removeClass("buttonDisable");c.splice(c.indexOf(f),
1);a(e).click(I[f]);f==y&&a(e).html("CALL "+b[f])}});a.each(c,function(d,b){var f=z[b];a(f).removeClass("buttonEnable");a(f).addClass("buttonHide");a(f).addClass("buttonDisable")})}};c.disable_all=b;c.send_action_stand=function(){d(8);A()};c.enable_AutoButtons=function(){a("#btAutoCheck").removeClass("autoButtonHide");a("#btAutoCheck").unbind("vclick",q);a("#btAutoCheck").bind("vclick",q);a("#btAutoCheckOrFold").removeClass("autoButtonHide");a("#btAutoCheckOrFold").unbind("vclick",x);a("#btAutoCheckOrFold").bind("vclick",
x);a("#btAutoCallAny").removeClass("autoButtonHide");a("#btAutoCallAny").unbind("vclick",t);a("#btAutoCallAny").bind("vclick",t)};c.disable_AutoButtons=A;c.resetAutoButtons=n})(window.actionButton=window.actionButton||{},jQuery);(function(c,a){var b={sit:function(a){var b=a.seat_no,c=a.info.uid;SeatList[b].sit(a.info.user,a.info.player_stake,c);if(c==window.user_info.id){window.user_info.sit_no=b;window.user_info.userIsSat=!0;for(b=0;b<SeatList.length;b++)SeatList[b].removeSeatdownbg();SeatList[a.seat_no].showStand();window.chat_dialog.display()}SeatList[a.seat_no].removeSeatdownbg()},bhc:function(a){dealCard.deal(a.seat_list);SeatList[parseInt(a.dealer)].showDealerBtn()},phc:function(a){var b=window.user_info.sit_no;poker_lib.setCard(a.cards[0],
"#cards_in_hand1");poker_lib.setCard(a.cards[1],"#cards_in_hand2");SeatList[b].cards=[];SeatList[b].cards.push(poker_lib.evaluateCard(a.cards[0]));SeatList[b].cards.push(poker_lib.evaluateCard(a.cards[1]));dealCard.set_hc(["#cards_in_hand1","#cards_in_hand2"])},winner:function(b){message_box.showMessage("We have a winner! ",3);for(var c=0;c<SeatList.length;c++)SeatList[c].hideBackCard();actionButton.disable_all();actionButton.resetAutoButtons();actionButton.disable_AutoButtons();window.user_info.userIsPlay=
!1;setTimeout(function(){a.each(b,function(b,d){void 0!=d.isWin&&(getSeatById(b),d.isWin&&(a.each(d.pot,function(a,d){pot_manager.distribute(b,d)}),SeatList[d.seat_no].showWinbg()))});a.each(SeatList,function(b,d){a.each(d.getChips(),function(a,b){b.remove()});d.cleanChips();d.clearStake();d.removeDealerBtn()});pot_manager.reset()},1E3);console.log("game finished===========+++++++++++++++++++++");console.log(b);a.each(b,function(a,b){console.log(b);if(void 0!=b.isWin){var d=getSeatById(a);d.cards=
[];d.setStake(b.stake,0);SeatList[b.seat_no].removeCountdown();if(void 0!=b.handcards){for(var c=[],e=0;e<b.handcards.length;e++)c.push(poker_lib.evaluateCard(b.handcards[e]));!1==b.isWin?d.showCardName(c):d.showWinCardName(c);console.log("check point");for(d=e=0;e<=b.handcards.length-1&&1>=d;e++)for(c=0;c<=public_card.length-1&&b.handcards[e]!=public_card[c];c++)c==public_card.length-1&&(0==d?SeatList[b.seat_no].setWinCard(b.handcards[e],1):SeatList[b.seat_no].setWinCard(b.handcards[e],2),d++);SeatList[b.seat_no].showWinCard()}}});
setTimeout(function(){for(var c=["#card0","#card1","#card2","#card3","#card4"],e=0;e<c.length;e++)a(c[e]).fadeOut("fast");a("#cards_in_hand1").fadeOut("fast");a("#cards_in_hand2").fadeOut("fast");a(".card-name").remove();a(".card-name-win").remove();dealCard.clear();a.each(b,function(a,b){void 0!=b.seat_no&&SeatList[b.seat_no].removeCard();b.isWin&&SeatList[b.seat_no].removeWinbg()})},2500)},next:function(a){SeatList[a.seat_no].setCountdown(a.to);SeatList[a.seat_no].userid==window.user_info.id?(window.user_info.userIsPlay&&
actionButton.disable_AutoButtons(),window.user_info.userIsPlay=!0,actionButton.enable_buttons(a.rights,a.amount_limits)):(actionButton.disable_all(),window.user_info.userIsPlay&&actionButton.enable_AutoButtons())},action:function(a){SeatList[a.seat_no].setStake(a.stake,a.table);SeatList[a.seat_no].showAction(actionName[a.action.toString()],a.action);SeatList[a.seat_no].removeCountdown(a.seat_no)},"public":function(a){window.public_card=a.cards;dealCard.send_public_card(a.cards);if(window.user_info.userIsSat){for(var b=
window.user_info.sit_no,c=[],f=0;f<a.cards.length;f++)c.push(poker_lib.evaluateCard(a.cards[f]));SeatList[b].showCardName(c)}},start:function(a){var b=parseInt(a.to),c=window.message_box.showMessage("",b),f=function(){c.html("Game start in "+b+" seconds");0<b&&setTimeout(f,1E3);b--};f();window.user_info.userIsSat&&(window.user_info.userIsPlay=!0);actionButton.disable_all();for(a=0;a<SeatList.length;a++)SeatList[a].hideBackCard()},pot:function(a){pot_manager.update(a.pot)},standup:function(b){console.log("standup Message");
a.each(b,function(a,b){if(void 0!=b.seat_no)if(SeatList[b.seat_no].seatStand(),SeatList[b.seat_no].removeCountdown(),window.user_info.userIsSat){if(parseInt(window.user_info.sit_no)==parseInt(b.seat_no)){SeatList[b.seat_no].removeStand();for(var c=0;9>c;c++)SeatList[c].getIsSat()||SeatList[c].showSeatdownbg();window.user_info.userIsPlay=!1;window.user_info.userIsSat=!1;window.user_info.sit_no=void 0;actionButton.disable_all();actionButton.disable_AutoButtons();window.chat_dialog.hide()}}else SeatList[b.seat_no].showSeatdownbg()})},
chat:function(a){chat_dialog.receive(a)}};c.process=function(a){if(b[a.msgType])b[a.msgType](a);else console.log("NOT SUPPORTED"),console.log(a)}})(window.board_msg_handler=window.board_msg_handler||{},jQuery);(function(){window.identifyCard=function(c){var a=0,b=[],d={},e=0;console.log(c);c.sort(function(a,b){return a.rank-b.rank});for(var g=0;g<c.length;g++){var f=c[g];e==f.rank&&(h=f.rank,d[h]=void 0!=d[h]?d[h]+1:2);e=f.rank}var e={},h;for(h in d)g=d[h],console.log(g),void 0!=e[g]?(e[g].count+=1,e[g].keys.push(h)):e[g]={count:1,keys:[h]};console.log("===================nop=====================");console.log(e[1]);console.log(e[2]);console.log(e[3]);console.log(e[4]);console.log(e[0]);console.log("====================end=====================");
if(void 0!=e[4]){h=e[4].keys[0];last_card=-1;for(g=0;g<c.length;g++)f=c[g],f.rank!=h&&f.rank>last_card&&(last_card=f.rank);return{score:7,kicker:[h,last_card]}}if(void 0!=e[3])if(2==e[3].count||void 0!=e[2]){a=6;b[0]=-1;temp=null;for(d=0;d<e[3].keys.length;d++)e[3].keys[d]>b[0]&&(b[0]=e[3].keys[d],temp=d);e[3].keys.splice(temp,1)}else{a=3;b[0]=e[3].keys[0];temp=[];for(d=0;d<c.length;d++)f=c[d],f.rank!=b[0]&&temp.push(f);temp.sort(function(a,b){return b.rank-a.rank});b.push(temp[0].rank);b.push(temp[1].rank)}else if(void 0!=
e[2])if(2<=e[2].count){a=2;e[2].keys.sort(function(a,b){return b.rank-a.rank});b.push(e[2].keys[0]);b.push(e[2].keys[1]);temp=[];for(d=0;d<c.length;d++)f=c[d],f.rank!=b[0]&&f.rank!=b[1]&&temp.push(f);temp.sort(function(a,b){return b.rank-a.rank});b.push(temp[0])}else{a=1;b.push(e[2].keys[0]);temp=[];for(d=0;d<c.length;d++)f=c[d],f.rank!=b[0]&&temp.push(f);temp.sort(function(a,b){return b.rank-a.rank});b.push(temp[0]);b.push(temp[1]);b.push(temp[2])}for(var g=h=0,k=!1,e=14==c[c.length-1].rank?1:null,
d=0;d<c.length;d++)f=c[d],console.log(f),null!=e&&f.rank==e+1?(h+=1,console.log(h),4<=h&&(k=!0,g=f.rank)):null!=e&&e==f.rank||(h=0),e=f.rank;if((k||4<=h)&&4>a)k=!0,a=4,b=[g];for(var j=!1,e={},d=0;d<c.length;d++)h=c[d].suit,e[h]=void 0!=e[h]?e[h]+1:1;h=-1;for(d in e)5<=e[d]&&(h=d);if(-1!=h&&5>a){j=!0;a=5;temp=[];for(d=0;d<c.length;d++)f=c[d],f.suit==h&&temp.push(f.rank);temp.sort(function(a,b){return b.rank-a.rank});b=temp}if(j&&k){straight_flush=hight=h=0;e=14==b[b.length-1]?1:null;for(d=0;d<b.length;d++)f=
b[d],null!=e&&f==e+1?(h+=1,4<=h&&(straight_flush=!0,g=f)):null!=e&&e==f||(h=0),e=f;if(straight_flush)return b=[g],{score:14==g?9:8,kicker:b}}j&&(b.sort(function(a,b){return b-a}),length=b.length-5,b.splice(5,length));if(0==a){for(d=0;d<c.length;d++)b.push(c[d].rank);b.sort(function(a,b){return b-a});length=b.length-5;b.splice(5,length)}return{score:a,kicker:b}};window.getHandCardName=function(c){return handCardName[c.score]}})($);(function(c){function a(){console.log("click start");b.send();c("#chat-input").val("");console.log("click end")}var b={message:[],init:function(){console.log("init sit dialog start");c("#chat-send-btn").bind(event_click,a);c(window).keypress(function(b){13==b.keyCode&&a()});c("input:text:visible:first").focus();c("#chat-history-btn").bind(event_click,function(){b.maximize()});console.log("init sit dialog end")},display:function(){c("#chat-dialog").css("display","block")},hide:function(){c("#chat-dialog").css("display",
"none")},maximize:function(){c("#chat-history").removeClass("chat-history-collapse");c("#chat-history").addClass("chat-history-expand");c("#chat-history-btn").text("C");c("#chat-history-btn").unbind(event_click);c("#chat-history-btn").bind(event_click,function(){b.minimize()})},minimize:function(){c("#chat-history").removeClass("chat-history-expand");c("#chat-history").addClass("chat-history-collapse");c("#chat-history-btn").text("E");c("#chat-history-btn").unbind(event_click);c("#chat-history-btn").bind(event_click,
function(){b.maximize()})},send:function(){var a=c("#chat-input").val();c.ajax({type:"post",url:"/send-chat",data:{seat:window.user_info.sit_no,message:a},success:function(a){console.log(a)},dataType:"json"})},receive:function(a){var b=SeatList[a.seat].username,g=c("<div class='temp-message' id='temp-message-"+a.timestamp+"'>"+a.content+"</div>");c("#chat-history").append("<div class='chat-message'>"+b+": "+a.content+"</div>");SeatList[a.seat].appendMessage(g);setTimeout(function(){g.addClass("temp-message-in")},
100);setTimeout(function(){g.addClass("temp-message-out")},2E3);setTimeout(function(){g.remove()},3E3)}};window.chat_dialog=b})($);(function(c,a){var b=function(b,c,d,e){a(b).show();a(b).animate({left:c,top:d},{duration:"fast",complete:function(){e&&e()}})},d=function(){e();a("#card0").fadeIn("fast",function(){a("#card1").fadeIn("fast",function(){a("#card2").fadeIn("fast")})})},e=function(){var b=a("#card0")[0],c=a("#card1")[0],d=a("#card2")[0],e=poker_lib.getCard("S","A"),g=poker_lib.getCard("S","J"),m=poker_lib.getCard("D","2");b.setAttribute("src",e);c.setAttribute("src",g);d.setAttribute("src",m)},g=function(a,b,c){b=poker_lib.getCard(b,
c);a.setAttribute("src",b)};c.deal=function(){a("#btCall").click(function(){""==a("#card0")[0].src||""==a("#card1")[0].src||""==a("#card2")[0].src?b("#chip0","215px","320px",function(){b("#chip4","150px","80px",function(){b("#chip3","390px","80px",function(){b("#chip2","580px","80px",function(){b("#chip1","700px","320px",function(){for(var b=0;4>=b;b++)a("#chip"+b).animate({left:"750px",top:"180px"},{duration:"slow"});d()})})})})}):""==a("#card3")[0].src?(g(a("#card3")[0],"D","K"),a("#card3").fadeIn("fast")):
""==a("#card4")[0].src&&(g(a("#card4")[0],"S","T"),a("#card4").fadeIn("fast"))})}})(window.game_control=window.game_control||{},jQuery);var table_init=function(){document.ontouchmove=function(a){a.preventDefault()};seatInit();actionButton.disable_all();actionButton.disable_AutoButtons();$.each(SeatList,function(a,b){take_place(b.id,b)});var c=poptip(),a=poptip(),b=poptip();c.init($("#backBtnTip"),"backBtnTip","Back to Previous Level","left",5);a.init($("#standTip"),"standTip","Stand Up","right",5);b.init($("#sitTip"),"sitTip","click one of the 9 seats to sit down ","bottom",5);localStorage.backBtnTip||(c.Msg(),localStorage.backBtnTip=
1);localStorage.standTip||(a.Msg(),localStorage.standTip=1);localStorage.sitDown||(b.Msg(),localStorage.sitDown=1)},fetch_user_info=function(){$.ajax({type:"get",url:"/userinfo",data:{},success:function(c){console.log("Below is user data:");console.log(c);window.user_info={};user_info.username=c.n;user_info.asset=c.s;user_info.level=c.l;user_info.id=c.id;enter()},dataType:"json",cache:!1})};$(function(){640>document.body.clientHeight&&$("#buttonWraper").css("top","86%")});
$(function(){$("#backBtn").bind("vclick",function(){window.user_info.userIsSat?(actionButton.send_action_stand(),setTimeout(function(){window.location="http://"+document.domain+":"+window.location.port+"/static/room/room.html"},500)):history.go(-1)})});
var enter=function(){$.post("/enter",{room_id:localStorage.current_room_id},function(c){console.log(c);if("success"==c.status){console.log("enter success!");window.user_info.userIsPlay=!1;window.room_info=c.room;c.room.pot&&board_msg_handler.process(c.room.pot);c.room.start&&board_msg_handler.process(c.room.start);listenBoardMessage(c.room.timestamp);for(var a=0;a<c.room.seats.length;a++){var b=c.room.seats[a],d=SeatList[a];null==c.room.seats[a]?SeatList[a].setIsSat(!1):(SeatList[a].sit(c.room.seats[a].user,
c.room.seats[a].player_stake,c.room.seats[a].uid),console.log("SET STAKE!!!"),console.log(b.status),1<b.status&&d.setStake(b.player_stake,b.table_amount),SeatList[a].userid==window.user_info.id?(sit_transit.transit(a),SeatList[a].showStand(),window.user_info.userIsSat=!0,window.user_info.sit_no=a):1<b.status&&dealCard.show_back_card(a))}if(!window.user_info.userIsSat)for(a=0;a<c.room.seats.length;a++)null==c.room.seats[a]&&SeatList[a].showSeatdownbg();c.room.publicCard&&(window.public_card=c.room.publicCard,
dealCard.send_public_card(c.room.publicCard));c.room.hc&&(poker_lib.setCard(c.room.hc[0],"#cards_in_hand1"),poker_lib.setCard(c.room.hc[1],"#cards_in_hand2"),window.user_info.userIsPlay=!0,$("#cards_in_hand1").fadeIn(),$("#cards_in_hand2").fadeIn());c.room.next&&board_msg_handler.process(c.room.next)}},"json")},index=1,curtimestamp=0;
function listenBoardMessageSocket(c){function a(){var a=JSON.stringify({timestamp:c});window.ws=g;g.send(a);h=!0}function b(a){var a=JSON.parse(a.data),b=0;f=0;console.log("=============================data==========================");console.log(a);console.log("===========================================================");console.log("current time stamp =>"+curtimestamp);console.log("time stamp =>"+a[0].timestamp);for(var c=0;c<a.length;c++)b=a[c].timestamp,b<=curtimestamp&&1!=a[c].resend||(curtimestamp=
b,console.log(b),board_msg_handler.process(a[c]));console.log(b);a=JSON.stringify({timestamp:b});g.send(a)}function d(){message_box.showMessage("WebSocket closed",5);h?setTimeout(function(){message_box.showMessage("Retrying",5);e();f+=1;10<f&&window.location.reload()},1E3):listenBoardMessage(c,!0)}function e(){var c=window.location.host;g="https:"==window.location.protocol?new WebSocket("wss://"+c+"/sk"):new WebSocket("ws://"+c+"/sk");g.onerror=d;g.onclose=d;g.onmessage=b;g.onopen=a}curtimestamp=
c;var g=0,f=0,h=0;e()}
var listenBoardMessage=function(c,a){if(!a)try{listenBoardMessageSocket(c);return}catch(b){message_box.showMessage("Seems your browser doesn't support WebSocket..."),a=!0}c||(c=-1);$.ajax({type:"post",url:"/listen-board-message",data:{timestamp:c},success:function(b){console.log("Below is listen-board-message:");console.log(b);for(var e=0;e<b.length;e++)c=b[e].timestamp,board_msg_handler.process(b[e]);listenBoardMessage(c,a)},error:function(b,e){console.log("listen board message replay error!!!");console.log(e);
6>index&&listenBoardMessage(c,a);index++},dataType:"json"})},take_place=function(c,a){a.getSeatDIV().click(function(){if(!a.getIsSat()&&!window.user_info.userIsSat)console.log(a),console.log(this),console.log("sliderbaris clicked"),show_loading(),$.ajax({type:"get",url:"/userinfo",data:{},success:function(b){console.log("Below is user data:");console.log(b);window.user_info={};user_info.username=b.n;user_info.asset=b.s;user_info.level=b.l;user_info.id=b.id;hide_loading();user_info.asset<window.room_info.min_stake?
show_no_enough_money(user_info,room_info):sit_down_dialog.show(a)},dataType:"json",cache:!1});else if(a.getIsSat()){console.log(a.getIsSat());console.log(a.player);for(key in a.player)void 0==a.player[key]&&(a.player[key]="#");window.SelectedSeat=a;a.player.show(a.player)}})},time_bar=function(c){SeatList[c].setCountdown(c)};function getSeatById(c){for(var a=0;a<SeatList.length;a++){var b=SeatList[a];if(b.getIsSat()&&b.userid==c)return b}};(function(c,a){var b;a(function(){b=a("<div></div>");b.appendTo(a("#container"));b.addClass("message_box")});var d=[];c.showMessage=function(c,g){contentbox=a("<label class='message_box_content'></label>");var f=a('<div class="message_box_entry"></div>');contentbox.appendTo(f);contentbox.html(c);d.unshift(f);a.each(d,function(a,b){b.css("top",45*a+"px")});f.prependTo(b);setTimeout(function(){f.fadeOut("slow",function(){f.remove();d.splice(d.indexOf(f),1)})},1E3*g);return contentbox}})(window.message_box=
window.message_box||{},jQuery);(function(c,a){var b=function(a,b){var c;switch(a){case "S":c="spade";break;case "H":c="heart";break;case "D":c="diamond";break;case "C":c="club";break;default:console.log("No such a poker.")}return"./pokers/"+c+"/"+b+".png"};c.setCard=function(c,e){var g,f;console.log(c);2==c.length?(g=c.charAt(1),f=c.charAt(0)):3==c.length&&(g=c.charAt(2),f="10");2!=c.length&&3!=c.length?console.log("ERROR!!!"):(console.log(g+" "+f),a(e)[0].src=b(g,f))};c.getCard=b;c.evaluateCard=function(a){var b,c;2==a.length&&
(b=a.charAt(1),c=a.charAt(0));3==a.length&&(b=a.charAt(2),c="10");a=parseInt(c);isNaN(a)&&("J"==c?a=11:"Q"==c?a=12:"K"==c?a=13:"A"==c&&(a=14));return{rank:a,suit:b}}})(window.poker_lib=window.poker_lib||{},jQuery);(function(c,a){function b(b){var c={};c.pid=b;var d=a("<span class='potSpan'></span>"),e=a("<img class='potChip'></img>"),g=a("<span></span>");g.appendTo(d);e.appendTo(d);d.appendTo(h);f[b]=c;c.coinElement=e;c.amountElement=g;c.potElement=d;c.amount=0;g.html(c.amount);c.setAmount=function(a){c.amount=a;g.html(c.amount)};return c}function d(b,c,d,e,f){var g=a('<div class="chip"></div>');g.css("background-image",d);g.css("left",b.left+"px");g.css("top",b.top+"px");g.appendTo(a("#bd"));setTimeout(function(){g.bind(eventTransitionEnd,
function(){g.remove();var a=/url\("?([^"]+)"?\)/;console.log("---------------");console.log(a.exec(d)[1]);console.log(d);e.attr("src",a.exec(d)[1])});f.remove();g.css("left",c.left+"px");g.css("top",c.top+"px")},1)}function e(b,c,d){var e=a('<div class="chip"></div>');e.css("background-image",d);e.css("left",b.left+"px");e.css("top",b.top+"px");e.appendTo(a("#bd"));setTimeout(function(){e.bind(eventTransitionEnd,function(){e.remove()});e.css("left",c.left+"px");e.css("top",c.top+"px")},1)}function g(b,
c){var e=!1;a.each(c,function(c,f){a.each(SeatList,function(c,g){if(g.userid==f){var h=g.getChips();a.each(h,function(a,c){var f=c.offset(),h=b.coinElement.offset(),j=c.css("background-image");d(f,h,j,b.coinElement,c);g.clearStake();e=!0})}})});return e}var f={},h;a(function(){h=a('<div class="potWrapper" align="center"></div>');h.appendTo(a("#container"))});c.update=function(c){a.each(c,function(a,c){f[c[1].pid]||b(c[1].pid)});a.each(c,function(a,b){console.log([a,b]);var c=b[1].pid;f[c].amount!=
b[1].amount&&(f[c].setAmount(b[1].amount),g(f[c],b[0])||f[c].coinElement.addClass("chip100"))});a.each(SeatList,function(b,c){a.each(c.getChips(),function(a,b){console.log("removing");console.log(b);b.remove()});c.cleanChips()})};c.distribute=function(a,b){var c=getSeatById(a).getSeatDIV().offset(),d=f[b],g=d.coinElement.offset();e(g,c,d.coinElement.css("background-image"))};c.reset=function(){a.each(f,function(a,b){b.potElement.remove()});f={}}})(window.pot_manager=window.pot_manager||{},jQuery);function Seat(c,a){var b={},d=$('<div class="seat"></div>'),e=$('<div class="seatbg"></div>'),g=$('<div class="countdown win seat_dowm_bg"></div>'),f=$('<div class="name"></div>'),h=$('<div class="money"></div>'),k=$('<div class="countdown"></div>'),j=$('<div class="countdown down"></div>'),l=$('<div class="winbg"></div>'),m=$('<div class="countdown win"></div>'),r=$('<img class="backcard bcard01" src = "./pokers/back.png">'),o=$('<img class="backcard bcard02" src = "./pokers/back.png">'),s=$('<img class="countdown win card01" src="./pokers/club/A.png">'),
A=$('<img class="countdown win card02" src="./pokers/club/A.png">'),n=$('<div class="chip"> </div>'),q=$('<div class="tstake"></div>'),x="seatPos"+a;$('<div class="portrait_border"></div>');var t=$('<img class="portrait"/>'),u=$("<p class='dealerBtn'>D</p>");q.appendTo(n);e.appendTo(d);n.appendTo(d);f.appendTo(d);h.appendTo(d);k.appendTo(d);j.appendTo(k);l.appendTo(d);m.appendTo(k);g.appendTo(m);s.appendTo(m);A.appendTo(m);d.addClass(x);t.appendTo(d);d.appendTo($("#container"));u.appendTo(d);var y=
!1,w=0,p=[],E=0;b.player=void 0;b.cards=[];b.showCardName=function(c){var e=b.cards,e=e.concat(c),c=window.getHandCardName(window.identifyCard(e));$("#card-name-"+a).remove();d.append($("<div class='card-name' id='card-name-"+a+"'>"+c+"</div>"))};b.showWinCardName=function(b){b=window.getHandCardName(window.identifyCard(b));$("#card-name-"+a).remove();d.append($("<div class='card-name-win' id='card-name-"+a+"'>"+b+" "+window.text_win+"!</div>"))};b.getIsSat=function(){return y};b.setIsSat=function(a){y=
a};b.player=void 0;b.sit=function(a,c,d){b.username=a;b.stake=c;b.userid=d;f.html(a);h.html(c);b.setIsSat(!0);$.ajax({type:"post",data:{id:b.userid},url:"/player-archive",success:function(a){console.log("-----------------");b.player=Player(a);t.attr("src",b.player.head_portrait)},dataType:"json"})};var v=[];b.pushBackCard=function(a){v.push(a)};b.popBackCard=function(){v.pop(back_card)};b.clearBackCard=function(){v=[]};b.setStake=function(a,b){h.html(a);if(0<b-w){var c=$('<div class="chipStart"></div>');
c.prependTo(d);c.addClass("chip100");setTimeout(function(){c.addClass("chip")},1);q.html(b);q.show();p.push(c)}};b.showAction=function(a,b){if(void 0!=a){var c=$("<p class='actionBox'>"+a+"</p>");c.appendTo(d);setTimeout(function(){c.remove()},5E3)}5==b&&($.each(v,function(a,b){b.remove()}),v=[])};b.showBackCard=function(){r.css("visibility","visible");o.css("visibility","visible")};b.hideBackCard=function(){r.css("visibility","hidden");o.css("visibility","hidden")};b.showDealerBtn=function(){u.fadeIn(500)};
b.removeDealerBtn=function(){u.css("display","none")};b.clearStake=function(){w=0;q.hide()};b.setCountdown=function(a){j.removeClass("countdown down");j.addClass("countdown down");j.show();var b=a/window.room_info.action_time;j.css("top",j.height()*(1-b));j.animate({top:j.height()},1E3*parseInt(a),function(){j.hide();j.removeAttr("style")})};b.removeCountdown=function(){j.stop();j.hide();j.removeAttr("style")};b.showWinCard=function(){s.show();A.show()};b.setWinCard=function(a,b){var c,d;console.log(a);
2==a.length&&(c=a.charAt(1),d=a.charAt(0));3==a.length&&(c=a.charAt(2),d="10");2!=a.length&&3!=a.length?console.log("ERROR!!!"):1==b?(console.log([poker_lib.getCard(c,d),"+++++++++++++++++++++++++++++++>>>>>>"]),s.attr("src",poker_lib.getCard(c,d))):A.attr("src",poker_lib.getCard(c,d))};b.removeCard=function(){s.removeAttr("style");A.removeAttr("style")};b.seatStand=function(){b.username="";b.stake="";b.userid="";f.html("");h.html("");t.remove();t=$('<img class="portrait" />');t.appendTo(d);b.setIsSat(!1)};
b.showSeatdownbg=function(){g.show();var a=1;E=setInterval(function(){0!=a%2?g.css("top","5px"):g.css("top","35px");a++},1E3)};b.removeSeatdownbg=function(){g.stop();clearInterval(E);g.removeAttr("style")};b.showWinbg=function(){l.show()};b.removeWinbg=function(){l.removeAttr("style")};b.getSeatDIV=function(){return d};b.getChipDIV=function(){return n};b.setPos=function(a){d.removeClass(x);x="seatPos"+a;d.addClass(x)};b.getChips=function(){return p};b.cleanChips=function(){p=[]};b.showStand=function(){$("#stand").removeClass("stand2");
$("#stand").addClass("stand1");$("#stand").click(function(){actionButton.send_action_stand();b.removeStand();b.removeCountdown()})};b.removeStand=function(){$("#stand").unbind("click");$("#stand").removeClass("stand1");$("#stand").addClass("stand2")};b.appendMessage=function(a){a.appendTo(d)};b.id=c;b.pos=a;b.setIsSat(!1);return b}
function Player(c){var a={id:void 0,username:void 0,family:void 0,position:void 0,level:void 0,asset:void 0,family_score:void 0,family_glory:void 0,total_game:void 0,won_game:void 0,percentage:void 0,max_reward:void 0,last_login:void 0,friends:void 0,init:function(b){a.id=b.id;a.head_portrait=b.head_portrait;a.username=b.name;a.family=b.family;a.position=b.position;a.level=b.level;a.asset=b.asset;a.family_score=b.family_score;a.total_game=b.total_game;a.won_game=b.won_game;a.percentage=b.percentage;
a.max_reward=b.max_reward;a.last_login=b.last_login;console.log(b.username);console.log(a.username)},show:function(a){player_info.show(a)},hide:function(){player_info.hide()}};a.init(c);console.log("==================");console.log(a);return a}function seatInit(){window.SeatList=[];for(i=0;9>i;i++)SeatList.push(Seat(i,i))}
(function(c){function a(){}var b=c('<div id="player-info-dialog" class="player-info"></div>'),d=c('<div id="player-info-bottom"></div>'),e=c('<div id="player-info-content"></div>'),g=c('<div  id="portrait_box"></div>'),f=c('<span id="username"></span>'),h=c('<span id="family"></span>'),k=c('<span id="level"></span>'),j=c('<span id="position"></span>'),l=c('<span id="asset"></span>'),m=c('<span id="family_score"></span>'),r=c('<span id="family_glory"></span>'),o=c('<span id="percentage"></span>'),
s=c('<span id="max_reward"></span>'),A=c('<span id="total_games"></span>');c('<span id="won_games"></span>');var n=c('<span id="last_login"></span>'),q=c('<img id="player_head_portrait" style="width: 102px; height: 126px;" />'),x=c('<div id="add_friend_btn"><div id="add_friend_text">\u52a0\u4e3a\u597d\u53cb</div></div>'),t=c('<div id="send_stake_btn"><div id="send_stake_text">\u8d60\u9001\u597d\u53cb</div></div>'),u=c('<div id="info_text"></div>'),y=c('<span id="send_amount"></span>'),w=c('<div class="closeBtn">X</div>');
w.appendTo(e);g.appendTo(e);u.appendTo(e);f.appendTo(e);h.appendTo(e);k.appendTo(e);j.appendTo(e);l.appendTo(e);m.appendTo(e);r.appendTo(e);o.appendTo(e);s.appendTo(e);A.appendTo(e);n.appendTo(e);q.appendTo(g);var p=slider_bar();w.bind("vclick",function(){b.hide()});e.appendTo(b);d.appendTo(b);b.init=function(){b.appendTo(c("#container"));p.setVar(a);p.setPosition(170,363)};b.show=function(a){e.css("display","block");d.css("display","block");q.attr("src",a.head_portrait);u.text(textDict.UInfo);f.text(textDict.id+
": "+a.username);k.text(textDict.rank+": "+a.level);l.text(textDict.property+": "+a.asset);o.text(textDict.winRate+": "+a.percentage);s.text(textDict.winBiggestStake+": "+a.max_reward);b.addClass("player-info-display-css");p.setVar(function(a){y.html("$"+a)});p.set_argument(1,window.user_info.asset,1)};b.hide=function(){e.hide();d.hide()};x.bind(event_click,function(){console.log("add_friend_btnt.click");c.ajax({type:"post",data:{user_id:window.SelectedSeat.userid},url:"/buddy-info/add",success:function(a){message_box.showMessage(a.status,
2)},dataType:"json"})});t.click(function(){console.log("send_stake_btnt.click")});window.player_info=b})($);(function(c,a){function b(b,c,k){var j=SeatList[b],l;l=k?a('<img class="backcard-noanima" src="./pokers/back.png" />').appendTo(a("#container")):a('<img class="backcard" src="./pokers/back.png" />').appendTo(a("#container"));b=j.getSeatDIV().offset();k=a("#container").offset();d(b.left-k.left,b.top-k.top,c,l,function(){if(j.userid==user_info.id){var b=g.pop();console.log(b);l.remove();a(b).fadeIn("fast");a("#cards_in_hand1").fadeIn();a("#cards_in_hand2").fadeIn()}});j.pushBackCard(l);e.push(l)}function d(a,
b,c,d,e){c+=720;e&&(d.bind("webkitTransitionEnd",e),d.bind("transitionend",e),d.bind("MSTransitionEnd",e),d.bind("oTransitionEnd",e));d.css({top:b+100,left:a+100});d.css("-moz-transform","rotate("+c+"deg)");d.css("-webkit-transform","rotate("+c+"deg)");d.css("-ms-transform","rotate("+c+"deg)");d.css("-o-transform","rotate("+c+"deg)");d.css("transform","rotate("+c+"deg)")}var e=[],g=[];c.deal=function(c){var d=0;a.each(c,function(a,c){setTimeout(function(){b(c,10)},d+=200)});a.each(c,function(a,c){setTimeout(function(){b(c,
-10)},d+=200)})};c.clear=function(){a.each(e,function(a,b){b.remove()});a.each(SeatList,function(a,b){b.clearBackCard()})};c.set_hc=function(a){g=a};c.send_public_card=function(b){for(var c=["#card0","#card1","#card2","#card3","#card4"],d=0;d<b.length;d++)!1==a(c[d]).is(":visible")&&(poker_lib.setCard(b[d],c[d]),a(c[d]).fadeIn("fast"))};c.show_back_card=function(a){b(a,10,1);b(a,-10,1)}})(window.dealCard=window.dealCard||{},jQuery);(function(c){c.transit=function(a){console.log(a+"   +++++=");for(var b=-1,c=a;9>c;c++)++b,SeatList[c].setPos(b);for(c=0;c<a;c++)++b,SeatList[c].setPos(b)}})(window.sit_transit=window.sit_transit||{},jQuery);function slider_bar_dialog(){function c(a){var b=Math.floor(a/((H-B)/((I-z)/D+1)))*D+z;b>I&&(b=I);b<z&&(b=z);C=b;$("#sit_dialog_amount").html(b);q.css("left",a-30+"px")}function a(a){B=n.offset().left;H=B+366;if(a.target==F)slider_button_down=!0,window.addEventListener(event_move,d),a.preventDefault();else{var c=get_event_position(a)[0],e=get_event_position(a)[1],f=k.css("width"),f=parseInt(f.slice(0,f.length-2)),g=k.css("height"),g=parseInt(g.slice(0,g.length-2)),h=k.offset().left,j=k.offset().top;
console.log([f,g,h,j]);c<h||e<j?b():c>h+f||e>j+g?b():a.preventDefault()}}function b(){J.ShowOut();G.ShowOut();k.hide();window.removeEventListener(event_down,a);window.removeEventListener(event_up,e);$("#submitButton").unbind("vclick")}function d(a){var b=get_event_position(a)[0];b>=B&&b<=H&&(b-=B,c(b),a.preventDefault())}function e(){removeEventListener(event_move,d)}function g(){var a=h.id;console.log(C);$.ajax({type:"post",url:"/sit-down",data:{seat:a,stake:C},success:function(b){console.log("Below is sit-down data:");
console.log(b);"success"==b.status&&(sit_transit.transit(a),window.user_info.userIsSat=!0,h.setIsSat(!0))},dataType:"json"});b()}var f={},h,k=$('<div id="sliderbar_dialog"></div>'),j=$('<div id="sliderbar_title"></div>'),l=$('<div id="testdiv"></div>'),m=$('<div id="textlabel"></div>'),r=$('<label for="amount">Stake: $</label>'),o=$('<label id="sit_dialog_amount"></label>'),s=$("<label></label>"),A=$('<label id="bind_amount"></label>'),n=$('<div class = "sit_slider_bar"></div>'),q=$('<div id = slider_button class = "sit_slider_button"></div>'),
x=$('<div id="sit_slider_textMin"></div>'),t=$('<div id="sit_slider_textMax"></div>'),u=$('<label id = "slider_min"></label>'),y=$('<label id = "slider_max"></label>'),w=$('<div id="submitButton" class="GeneralBtn"></div>'),p=$('<div class="closeBtn" style="top:57px;left:530px">X</div>'),E=$("<p></p>"),v=$("<p></p>"),z,I,D,C=0,F,B,H,J=poptip(),G=poptip();f.slider_bar_setTitle=function(a){j.html(a)};f.init=function(){B=n.offset().left;H=B+366;c(0);k.hide()};(function(){j.appendTo(k);p.appendTo(k);
p.bind("vclick",function(){b()});l.appendTo(k);m.appendTo(l);E.appendTo(m);r.appendTo(E);o.appendTo(E);v.appendTo(m);s.appendTo(v);A.appendTo(v);n.appendTo(l);q.appendTo(n);x.appendTo(l);u.appendTo(x);t.appendTo(l);y.appendTo(t);w.appendTo(k);k.appendTo("#sit_down_dialog");F=q[0];w.text(window.textDict.Sit)})();f.show=function(b){J.init($("#sliderBtnTip"),"sliderBtnTip","Slide the button to change stake","bottom",10);G.init($("#sitBtnTip"),"sitBtnTip","Click this button to sit down","bottom",10);
J.Msg();G.Msg();k.show();h=b;$("#submitButton").bind("vclick",g);window.addEventListener(event_down,a);window.addEventListener(event_up,e);I=Math.min(window.room_info.max_stake,window.user_info.asset);z=window.room_info.min_stake;D=window.room_info.blind;u.html(z);y.html(I);c(0)};return f}
function slider_bar(){function c(a){g=m.offset().left;f=g+366;a.target==l&&(window.addEventListener(event_move,b),a.preventDefault())}function a(){window.removeEventListener(event_move,b)}function b(a){a=get_event_position(a)[0];a>=g&&a<=f&&(a-=g,d(a))}function d(a){g=m.offset().left;f=g+366;var b=Math.floor(a/((f-g)/((h-k)/j+1)))*j+k;b>h&&(b=h);b<k&&(b=k);o=b;s(o);console.log(b);r.css("left",a-30+"px")}var e={},g,f,h,k,j,l,m=$('<div class = "slider_bar"></div>'),r=$('<div class = "slider_button"></div>'),
o,s;e.create=function(b,d,h,j){r.appendTo(m);m.appendTo(b);g=m.offset().left;f=g+366;5==arguments.length?e.set_argument(d,h,j,arguments[4]):e.set_argument(d,h,j);window.addEventListener(event_down,c);window.addEventListener(event_up,a);l=r[0]};e.set_argument=function(a,b,c){h=b;k=a;j=c;4==arguments.length?d(arguments[3]):d(0)};e.setPosition=function(a,b){m.css("left",a);m.css("top",b)};e.getCurNum=function(){return o};e.setVar=function(a){s=a};e.curNum=o;return e};
