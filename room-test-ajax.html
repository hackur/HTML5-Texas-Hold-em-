
<!DOCTYPE HTML>
<html>
<head>
<script src="./static/jquery.min.js"></script>
</head>
<body>
<div id="login">

	<!--
<label>username:</label><input name="username" type="text" value="{{ username }}"/><br />
<label>password:</label><input name="password" type="password" value="123" /><br />
<button id="login">login</button>
-->
{{ username }}
</div>

<div>
<label>room no:</label><input name="room_id" type="text" value="1" /><br />
<!-- <button id="enter">enter</button> -->

</div>
<div>
	<label>sit no:</label><input name="sit_no" type="text" value="{{ sitno }}"/><br />
<button id="sit_down">sit down</button>
</div>
<div id="msg"> </div>
</body>
<script>
var username= "{{  username }}";
$(function(){
	var username = " {{ username }}";
	var password = "123";
	var enter = function(){
		var room = $('input[name="room_id"]').val();
		$.post(
			"./enter",
			{room_id:room,username:username, timestamp:1},
			function(data){
				console.log(data);
				console.log(data["status"]);
				if(data.status=='success'){
					$("#msg").append( "Enter Success<br>");
					listenBoardMessage();
				}
				$("#msg").append(JSON.stringify(data) + "<br>");
			},
			'json'
		);
	};
	$.post(
		"./login",
		{username:username, password:password},
		function(data){
			$('#login').append(JSON.stringify(data));
			enter();
		},
		'json'
	);

	$('#sit_down').click(function(){
		var seat = $('input[name="sit_no"]').val();
//		postBoardMessage(message);
		$.ajax({
			type:'post',
			url:"./sit-down",
			data:{seat:seat, offset:1,username:username, timestamp:1},
			success:function(data){
				console.log(data);
				$("#msg").append(JSON.stringify(data) + "<br>");
			},
			dataTye:'json'
		});
	});
});
function listenBoardMessage(timestamp){
	if(!timestamp) timestamp = -1;

	$.ajax({
		type:'post',
		url:"./listen-board-message",
		data:{offset:1,username:username,timestamp:timestamp},
		success:function(data){
			console.log("listen board message reply success")
			console.log(data);
			data = JSON.parse(data);
			for(i = 0; i < data.length; i++){
				timestamp = data[i].timestamp;
				console.log(data[i]);
			}
			listenBoardMessage(timestamp);
			$("#msg").append(JSON.stringify(data) + "<br>");
			$("#msg").append(timestamp + "<br>");
		},
		error: function(XMLHttpRequest, textStatus, errorThrown) {
			console.log("listen board message reply error")
			console.log(textStatus);
			if(index < 6){
				listenBoardMessage();
			}
			index++;
		},
		dataTye:'json'
	});
}

var index =1;
function postBoardMessage(message){
}
</script>
</html>
