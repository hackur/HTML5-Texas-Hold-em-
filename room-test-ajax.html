
<!DOCTYPE HTML>
<html>
<head>
<script src="./static/jquery.min.js"></script>
</head>
<body>
<div id="login">

	<!--
<label>username:</label><input name="username" type="text" value="{{ username }}"/><br />
<label>password:</label><input name="password" type="password" value="123" /><br />
<button id="login">login</button>
-->
{{ username }}
</div>

<div>
<label>room no:</label><input name="room_id" type="text" value="1" /><br />
</div>
<div>
	<label>sit no:</label><input name="sit_no" type="text" value="{{ sitno }}"/><br />
<button id="sit_down">sit down</button>
</div>
<div>
<input name="stake" type="text" /> <button id="put_stake_btn">下注</button> <br />
<button id="call_stake_btn">跟注</button> <br />
<input name="raise_stake" type="text" /> <button id="raise_stake_btn">加注</button> <br />
<button id="check_btn">看牌</button> <br />
<button id="give_up_btn">放弃</button> <br />

</div>
<div id="msg"> </div>
</body>
<script>
var username= "{{  username }}";
$(function(){
	$('#put_stake_btn').click(function(){
		var stake	= $('#stack').val();
		var message = {amount:stake, action:1};
		postMessage(JSON.stringify(message));
	});

	$('#call_stake_btn').click(function(){
		var message = {action:2};
		postMessage(JSON.stringify(message));
	});

	$('#raise_stake_btn').click(function(){
		var amount	= $('#raise_stake').val();
		var message = {amount:amount, action:3};
		postMessage(JSON.stringify(message));
	});

	$('#check_btn').click(function(){
		var message = {action:4};
		postMessage(JSON.stringify(message));
	});

	$('#give_up_btn').click(function(){
		var message = {action:5};
		postMessage(JSON.stringify(message));
	});

	var postMessage = function(message){
		$.post(
			"./post-board-message",
			{message:message},
			function(data){
				$("#msg").append(JSON.stringify(data) + "<br>");
			},
			'json'
		);
	};
	var username = " {{ username }}";
	var password = "123";
	var enter = function(){
		var room = $('input[name="room_id"]').val();
		$.post(
			"./enter",
			{room_id:room,username:username, timestamp:1},
			function(data){
				console.log(data);
				console.log(data["status"]);
				if(data.status=='success'){
					$("#msg").append( "Enter Success<br>");
					listenBoardMessage();
				}
				$("#msg").append(JSON.stringify(data) + "<br>");
			},
			'json'
		);
	};
	$.post(
		"./login",
		{username:username, password:password},
		function(data){
			$('#login').append(JSON.stringify(data));
			enter();
		},
		'json'
	);

	$('#sit_down').click(function(){
		var seat = $('input[name="sit_no"]').val();
//		postBoardMessage(message);
		$.ajax({
			type:'post',
			url:"./sit-down",
			data:{seat:seat, offset:1,username:username, timestamp:1},
			success:function(data){
				console.log(data);
				$("#msg").append(JSON.stringify(data) + "<br>");
			},
			dataTye:'json'
		});
	});
});
function listenBoardMessage(timestamp){
	if(!timestamp) timestamp = -1;

	$.ajax({
		type:'post',
		url:"./listen-board-message",
		data:{offset:1,username:username,timestamp:timestamp},
		success:function(data){
			console.log("listen board message reply success")
			console.log(data);
			data = JSON.parse(data);
			for(i = 0; i < data.length; i++){
				timestamp = data[i].timestamp;
				console.log(data[i]);
			}
			listenBoardMessage(timestamp);
			$("#msg").append(JSON.stringify(data) + "<br>");
			$("#msg").append(timestamp + "<br>");
		},
		error: function(XMLHttpRequest, textStatus, errorThrown) {
			console.log("listen board message reply error")
			console.log(textStatus);
			if(index < 6){
				listenBoardMessage();
			}
			index++;
		},
		dataTye:'json'
	});
}

var index =1;
function postBoardMessage(message){
}
</script>
</html>
